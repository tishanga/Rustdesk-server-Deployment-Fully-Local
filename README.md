# RustDesk LAN Server â€“ Custom Installer

This repository provides a **LANâ€‘first RustDesk server and client installation workflow**.

It solves a common issue with the upstream RustDesk `install.sh`:

> The official script embeds the **public WAN IP** into the configuration key, which breaks **LANâ€‘only or internal deployments** and makes mass client rollout impractical.

This project modifies the server and client installers so that:

* The **LAN IP** is embedded into the RustDesk configuration key
* Clients autoâ€‘configure without manual server/key entry
* Works for **offline / airâ€‘gapped / enterprise LAN environments**

---

## âœ¨ What This Repo Does

* Installs **RustDesk server (hbbs + hbbr)** bound to a **LAN IP**
* Generates a **correct configuration key** (LAN IP + public key)
* Hosts **preâ€‘configured Windows & Linux client installers** via an internal HTTP server
* Enables **mass deployment** without touching client settings manually

---

## ğŸ§± Supported Environments

### Server

* Ubuntu Server (recommended)
* Debian
* CentOS / RHEL
* Minimal installs supported

### Clients

* Windows (PowerShell installer)
* Linux (shell installer)

---

## ğŸ“¦ Repository Structure

```
.
â”œâ”€â”€ server/
â”‚   â””â”€â”€ install.sh              # LANâ€‘only RustDesk server installer
â”œâ”€â”€ clients/
â”‚   â”œâ”€â”€ WindowsAgentAIOInstall.ps1
â”‚   â””â”€â”€ linuxclientinstall.sh
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ installation-notes.md
â””â”€â”€ README.md
```

---

## ğŸš€ Server Installation (LAN Only)

### âš ï¸ Important â€“ LAN IP Configuration

The official RustDesk installer automatically detects the **public WAN IP** using a DNS query:

```bash
wanip=$(dig @resolver4.opendns.com myip.opendns.com +short)
```

This behavior **breaks LAN-only deployments** because the generated configuration key embeds the wrong address.

This installer **replaces WAN auto-detection with a manually defined LAN IP**.

Before running the script, **you must edit the installer and set your own LAN IP or internal DNS name**:

```bash
wanip="<YOUR_LAN_IP>"
```

âœ” This ensures the generated configuration key is valid for all LAN clients
âœ” No manual client reconfiguration is required

---

### 1ï¸âƒ£ Prepare the Server

* Use a **static LAN IP** or internal DNS name
* Ensure ports **21115â€“21119/TCP** are open

```bash
sudo apt update
sudo apt install -y wget curl net-tools nano ufw
```

(Optional) Enable firewall: In some case this needs to enabled keep this in mind

```bash
sudo ufw allow 21115:21119/tcp
sudo ufw enable
```
---

### 2ï¸âƒ£ Download & Configure the Installer

Download the server installation script from this repository:

```bash
wget <YOUR_GITHUB_RAW_INSTALL_SH_URL>
```

Make it executable:

```bash
chmod +x install.sh
```

---

### 3ï¸âƒ£ Configure LAN IP (Required)

You **must edit the installer before running it**.

> âš ï¸ Root or sudo privileges are required to edit the file.

Edit the script:

```bash
sudo nano install.sh
```

Locate the following line:

```bash
wanip="<YOUR_LAN_IP>"
```

Replace it with your **serverâ€™s IP**:

```bash
wanip="192.168.x.x"
```

âœ” This replaces the default WAN IP auto-detection
âœ” Ensures the generated configuration key works for LAN clients

---

### 3ï¸âƒ£ Run the Installer

```bash
chmod +x install.sh
./install.sh
```

During installation you will:

* Confirm LANâ€‘based setup
* install the internal HTTP server (this step is essential its generating config key later in the client installation that you need to replace cfg key is essential)

---

### 4ï¸âƒ£ Installation Output

At the end you will receive:

* **LAN Server Address**
* **Public Key**
* **HTTP installer URL**
* **Admin credentials** for installer hosting

Example:

```
Server Address : <LAN_IP>
Public Key     : <PUBLIC_KEY>
Installer URL  : http://<LAN_IP>:8000
Username       : admin
Password       : <AUTO_GENERATED>
```

---

## ğŸ–¥ï¸ Client Installation

This repository supports **fully automated client installation** with **zero manual steps** beyond granting administrator permission.

---

## ğŸªŸ Windows Client (Oneâ€‘Click BAT Installer)

Download via wget
```
wget https://github.com/tishanga/Rustdesk-server-Deployment-Fully-Local/blob/main/clients/WindowsAgentAIOInstall.bat
```
or

A **Windows `.bat` installer** is included for environments where PowerShell execution policies or manual steps are undesirable.

### âœ… What the BAT Installer Does

* Automatically launches PowerShell with **ExecutionPolicy bypass**
* Runs the RustDesk installer **as Administrator**
* Applies the embedded **RustDesk configuration key**
* Generates a **unique RustDesk ID and password**

### ğŸ§© User Action Required

Before distributing the installer:

1. Open the `.bat` file via and editor preferably notepad++
2. Replace the configuration key with the one generated by your server install:

```text
set RUSTDESK_CFG="REPLACE THE CONFIGRATION KEY HERE"
```
```example
set RUSTDESK_CFG=vgbepiougbev9831tb3g812bvg8287v2bv28vbggb2v2bvg921bv319bgvfb3c210bgc9bgc3b27bg1v....

```
your cfg can be found in
```
cat /opt/
```
No other changes are required.



### â–¶ï¸ Installation Steps (End User)

1. **Doubleâ€‘click** the `.bat` file
2. Approve the **UAC / Administrator** prompt
3. Wait for installation to complete

âœ” No PowerShell commands
âœ” No execution policy changes
âœ” No manual RustDesk configuration

---

## ğŸ§ Linux Client (Automated Script)

```bash
chmod +x linuxclientinstall.sh
./linuxclientinstall.sh
```

The Linux installer automatically:

* Downloads RustDesk
* Applies the embedded configuration key
* Registers RustDesk as a service

---

### Linux (Automated)

```bash
chmod +x linuxclientinstall.sh
./linuxclientinstall.sh
```

---

## ğŸ” Verifying Client Connection

In RustDesk client:

```
Settings â†’ Network â†’ ID/Relay Server
```

Ensure:

* Server IP/DNS matches your LAN server
* Public key matches `/opt/rustdesk/id_ed25519.pub`
* Status shows **READY**

If status is **READY**/u for more secure connection setup your own server/u , the client is connected to the public RustDesk network.
If status is **READY** , the client is connected to the LAN RustDesk Server. 

---

## ğŸ” Public Key Location (Server)

```bash
cat /opt/rustdesk/id_ed25519.pub
```

---

## âš ï¸ Notes & Limitations

* Designed for **LAN / internal deployments**
* WAN access requires DNS + NAT (not covered here)
* API server optional (not required for LAN use)
* HTTP installer is **internal only**

---

## ğŸ§  Why This Exists

RustDeskâ€™s official installer is WANâ€‘first by design.

In **enterprise / SOC / lab / offline networks**, this causes:

* Broken autoâ€‘config keys
* Manual client reconfiguration
* No scalable deployment

This project fixes that cleanly.

---

## ğŸ“„ License & Attribution

* RustDesk: [https://github.com/rustdesk](https://github.com/rustdesk)
* Original installer base: dinger1986/rustdeskinstall

This repo modifies behavior **only for LAN deployments**.

---

If youâ€™re deploying RustDesk internally at scale â€” this is the sane way to do it ğŸš€

##Tips

If you want to restart the services use the following commands:

```
sudo systemctl restart rustdesksignal
sudo systemctl restart rustdeskrelay
```
  


